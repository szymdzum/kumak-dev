---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import Head from "@components/Head.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import FormattedDate from "@components/FormattedDate.astro";
import { BlogRoutes } from "@utils/url.ts";

type BlogPost = CollectionEntry<"blog">;

const posts = (await getCollection("blog")).sort(
  (a: BlogPost, b: BlogPost) =>
    b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="en">
  <Head />
  <body>
    <Header />
    <main class="blog-main">
      <section class="blog-posts-container">
        <h1 class="page-title">Blog</h1>
        <div class="posts-grid">
          {
            posts.map((post: BlogPost) => (
              <article class="post-card">
                <div class="image-container">
                  {post.data.heroImage ? (
                    <img src={post.data.heroImage} alt="" />
                  ) : (
                    <div class="placeholder-image">
                      <span>{post.data.title.charAt(0)}</span>
                    </div>
                  )}
                </div>
                <div class="card-content">
                  <header class="card-header">
                    <h2 class="card-title">
                      <a href={BlogRoutes.post(post.slug)}>{post.data.title}</a>
                    </h2>
                    <div class="post-meta">
                      <FormattedDate date={post.data.pubDate} />
                    </div>
                  </header>
                  <div class="card-excerpt">
                    <p>{post.data.description}</p>
                  </div>
                  <footer class="card-footer">
                    <a href={BlogRoutes.post(post.slug)} class="read-more-link">
                      Read more
                    </a>
                  </footer>
                </div>
              </article>
            ))
          }
        </div>
      </section>
    </main>
    <Footer />

  </body>
</html>
