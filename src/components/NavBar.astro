---
import { Icon } from 'astro-icon/components';
import { siteConfig } from "@/site-config";
import LlmsTxtIcon from "./LlmsTxtIcon.astro";
---

<header>
  <div>
    <a href="/" aria-label="The Null Hypothesis home">[The Null Hypothesis]</a>
    <nav aria-label="Social links">
      {Object.entries(siteConfig.socials).map(([key, social]) => {
        const isExternal = social.url.startsWith("http");
        return (
          <a
            href={social.url}
            target={isExternal ? "_blank" : undefined}
            rel={isExternal ? "noopener noreferrer" : undefined}
            aria-label={isExternal ? `${siteConfig.author} on ${social.name}` : `Subscribe via ${social.name}`}
            data-social={isExternal ? key : undefined}
          >
            <Icon name={`lucide:${key}`} size={24} />
          </a>
        );
      })}
      <a href="/llms-full.txt" aria-label="LLMs.txt full content">
        <LlmsTxtIcon />
      </a>
    </nav>
  </div>
</header>

<style>
  header {
    padding: var(--space-md) 0;
  }

  div {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: var(--content-width);
    margin: 0 auto;
    padding: 0 var(--space-md);
  }

  header > div > a {
    font-family: var(--font-family-display);
    color: var(--color-primary);
    text-decoration: none;
    font-weight: var(--font-weight-bold);
    font-size: var(--text-lg);
    letter-spacing: var(--letter-spacing-tight);
    transition: color var(--transition-fast);
  }

  header > div > a:hover {
    color: var(--color-primary);
  }

  nav {
    display: flex;
    gap: calc(var(--space-xs) * 0.5);
  }

  nav a {
    color: var(--color-text);
    transition: color var(--transition-fast);
  }

  nav a:hover {
    color: var(--color-primary);
  }

  nav svg {
    display: block;
  }

  @media (max-width: 480px) {
    header > div > a {
      font-size: calc(var(--text-base) * 1.1);
    }

    nav svg {
      width: 20px;
      height: 20px;
    }
  }
</style>

<script>
  function initSocialTracking(): void {
    document.querySelectorAll<HTMLAnchorElement>('a[data-social]').forEach((link) => {
      link.addEventListener('click', () => {
        const social = link.dataset.social;
        if (social && typeof umami !== 'undefined') {
          umami.track('social-click', { platform: social });
        }
      });
    });
  }

  document.addEventListener('astro:page-load', initSocialTracking);
</script>
