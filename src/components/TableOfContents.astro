---
export interface Props {
  headings: Array<{
    depth: number;
    slug: string;
    text: string;
  }>;
}

const { headings } = Astro.props;
---

<nav class="toc" aria-label="Table of Contents">
  <h2 class="toc__title">Table of Contents</h2>
  <ol class="toc__list">
    {headings.map((heading) => (
      <li class={`toc__item toc__item--depth-${heading.depth}`}>
        <a href={`#${heading.slug}`} class="toc__link">
          {heading.text}
        </a>
      </li>
    ))}
  </ol>
</nav>

<style>
  .toc {
    background: var(--muted-background, rgba(255, 255, 255, 0.05));
    border: 1px solid var(--border-color, rgba(255, 255, 255, 0.1));
    border-radius: 0.5rem;
    padding: 1.5rem;
    margin: 2rem 0;
  }

  .toc__title {
    font-size: 1.125rem;
    font-weight: 600;
    margin: 0 0 1rem 0;
    color: var(--accent-color, #6366f1);
  }

  .toc__list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .toc__item {
    margin: 0.5rem 0;
  }

  .toc__item--depth-2 {
    padding-left: 0;
  }

  .toc__item--depth-3 {
    padding-left: 1rem;
  }

  .toc__item--depth-4 {
    padding-left: 2rem;
  }

  .toc__item--depth-5,
  .toc__item--depth-6 {
    padding-left: 3rem;
  }

  .toc__link {
    color: var(--text-color, #ffffff);
    text-decoration: none;
    font-size: 0.875rem;
    line-height: 1.5;
    transition: color 0.2s ease;
    display: block;
    padding: 0.25rem 0;
  }

  .toc__link:hover {
    color: var(--accent-color, #6366f1);
  }

  /* Smooth scrolling behavior for anchor links */
  html {
    scroll-behavior: smooth;
  }
</style>

<script>
  // Add active state to current section in TOC
  const tocLinks = document.querySelectorAll('.toc__link');
  const headings = document.querySelectorAll('h2, h3, h4, h5, h6');

  if (tocLinks.length > 0 && headings.length > 0) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          const id = entry.target.getAttribute('id');
          const tocLink = document.querySelector(`.toc__link[href="#${id}"]`);
          
          if (entry.isIntersecting) {
            // Remove active class from all links
            tocLinks.forEach(link => link.classList.remove('toc__link--active'));
            // Add active class to current link
            tocLink?.classList.add('toc__link--active');
          }
        });
      },
      {
        rootMargin: '-10% 0% -80% 0%',
        threshold: 0
      }
    );

    headings.forEach((heading) => {
      if (heading.getAttribute('id')) {
        observer.observe(heading);
      }
    });
  }
</script>

<style is:global>
  .toc__link--active {
    color: var(--accent-color, #6366f1) !important;
    font-weight: 600;
  }
</style>