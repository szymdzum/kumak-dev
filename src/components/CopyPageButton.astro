---
import { Icon } from 'astro-icon/components';

interface Props {
  markdown: string;
}

const { markdown } = Astro.props;
---

<button class="copy-page-button" id="copyPageButton" aria-label="Copy page as Markdown">
  <Icon name="lucide:copy" size={16} />
  <span id="buttonText">Copy page</span>
</button>

<script define:vars={{ markdown }}>
  const button = document.getElementById('copyPageButton');
  const buttonText = document.getElementById('buttonText');

  button.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(markdown);
      buttonText.textContent = 'Copied';
      setTimeout(() => {
        buttonText.textContent = 'Copy page';
      }, 2000);
    } catch (err) {
      console.error('Failed to copy:', err);
      buttonText.textContent = 'Failed';
      setTimeout(() => {
        buttonText.textContent = 'Copy page';
      }, 2000);
    }
  });
</script>

<style>
  .copy-page-button {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2xs);
    padding: 0;
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    background: none;
    border: none;
    cursor: pointer;
    transition: color 0.2s ease;
  }

  .copy-page-button:hover {
    color: var(--color-text);
  }

  .copy-page-button :global(svg) {
    flex-shrink: 0;
  }

  .copy-page-button span {
    display: inline-block;
    min-width: 4.5rem;
    text-align: left;
  }

  @media (max-width: 640px) {
    .copy-page-button span {
      display: none;
    }
  }
</style>
