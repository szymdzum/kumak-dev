---
// Tracks scroll depth milestones (25%, 50%, 75%, 100%) for article engagement
---

<script>
  document.addEventListener('astro:page-load', () => {
    const milestones = [25, 50, 75, 100];
    const tracked = new Set<number>();

    function getScrollPercent(): number {
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      return docHeight <= 0 ? 100 : Math.round((window.scrollY / docHeight) * 100);
    }

    function checkMilestones(): void {
      const percent = getScrollPercent();
      for (const m of milestones) {
        if (percent >= m && !tracked.has(m)) {
          tracked.add(m);
          track.scroll(m);
        }
      }
    }

    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(() => { checkMilestones(); ticking = false; });
        ticking = true;
      }
    });
    checkMilestones();
  });
</script>
