---
import FormattedDate from "@components/FormattedDate.astro";
import { BlogRoutes } from "@utils/url.ts";
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";

interface Props {
  post: CollectionEntry<"blog">;
  index?: number;
}

const { post, index = 999 } = Astro.props;
const shouldLazyLoad = index > 1; // First 2 images load eagerly
---

<article>
  <div>
    <h3>{post.data.title}</h3>
    <p>{post.data.description}</p>
    <div>
      <a href={BlogRoutes.post(post.slug)}>
        Read more
      </a>
      <FormattedDate date={post.data.pubDate} />
    </div>
  </div>
  <div>
    <Image
      src={post.data.heroImage || "/blog-placeholder-1.jpg"}
      alt={post.data.title}
      width={600}
      height={450}
      format="webp"
      quality={80}
      loading={shouldLazyLoad ? "lazy" : "eager"}
      fetchpriority={index === 0 ? "high" : "auto"}
    />
  </div>
</article>
