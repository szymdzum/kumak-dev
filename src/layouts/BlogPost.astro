---
import FormattedDate from "@components/FormattedDate.astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import { formatReadingTime } from "@utils/readingTime";
import type { CollectionEntry } from "astro:content";

type Props = CollectionEntry<"blog">["data"] & {
  id?: string;
  slug?: string;
  body?: string;
};

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  draft,
  category,
  tags,
  body = ""
} = Astro.props;

const readingTime = formatReadingTime(body);
---

<BaseLayout
  title={title}
  description={description}
>
  <article>
    {heroImage && (
      <figure>
        <img src={heroImage} alt={title} />
      </figure>
    )}

    <header>
      <div class="meta">
        <span>{category}</span>
        {draft && import.meta.env.DEV && (
          <span data-badge="draft">DRAFT</span>
        )}
        <span aria-hidden="true">•</span>
        <time datetime={pubDate.toISOString().split('T')[0]}>
          <FormattedDate date={pubDate} />
        </time>
        <span aria-hidden="true">•</span>
        <span>{readingTime}</span>
      </div>

      <h1>{title}</h1>

      <p>{description}</p>

      {tags && tags.length > 0 && (
        <div class="tags">
          {tags.map((tag: string) => (
            <span>#{tag}</span>
          ))}
        </div>
      )}

      {updatedDate && (
        <div class="updated">
          <time datetime={updatedDate.toISOString().split('T')[0]}>
            Last updated: <FormattedDate date={updatedDate} />
          </time>
        </div>
      )}
    </header>

    <div class="prose">
      <slot />
    </div>
  </article>
</BaseLayout>
