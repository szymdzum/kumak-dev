---
import FormattedDate from "@components/FormattedDate.astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import { formatReadingTime } from "@utils/readingTime";
import type { CollectionEntry } from "astro:content";

type Props = CollectionEntry<"blog">["data"] & {
  id?: string;
  slug?: string;
  body?: string;
};

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  draft,
  category,
  tags,
  body = ""
} = Astro.props;

const readingTime = formatReadingTime(body);
---

<BaseLayout title={title} description={description}>
  <article class="article">
    {heroImage && (
      <figure class="hero-image">
        <img src={heroImage} alt={title} />
      </figure>
    )}

    <header class="article__header">
      <div class="article__meta">
        <span>{category}</span>
        {draft && import.meta.env.DEV && (
          <span class="draft-badge">DRAFT</span>
        )}
        <span class="separator" aria-hidden="true">•</span>
        <time datetime={pubDate.toISOString().split('T')[0]}>
          <FormattedDate date={pubDate} />
        </time>
        <span class="separator" aria-hidden="true">•</span>
        <span class="reading-time">{readingTime}</span>
      </div>

      <h1 class="article__title">{title}</h1>

      <p class="article__description">{description}</p>

      {tags && tags.length > 0 && (
        <div class="article__tags">
          {tags.map((tag: string) => (
            <span class="tag">#{tag}</span>
          ))}
        </div>
      )}

      {updatedDate && (
        <div class="article__updated">
          <time datetime={updatedDate.toISOString().split('T')[0]}>
            Last updated: <FormattedDate date={updatedDate} />
          </time>
        </div>
      )}
    </header>

    <div class="article__body prose">
      <slot />
    </div>
  </article>
</BaseLayout>
